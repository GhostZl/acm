
//提交题目accept后根据组配置更新分数
DELIMITER |
create trigger updatescore after update
on solution for each row
begin
 	declare lv varchar(48);
    declare gid varchar(48);
   declare lvsc int;
   declare jsonkey varchar(48);
   
  if new.result=4 THEN
  select groud_id into gid from users where user_id=new.user_id;
  select level into lv from problem where problem_id=new.problem_id;
  SET jsonkey = CONCAT('$."',lv,'"');
  select JSON_EXTRACT(level_score, jsonkey) into lvsc from group_config where group_id= gid;
  UPDATE users SET users.score = users.score+lvsc WHERE user_id = new.user_id; 
  end IF;
end|
DELIMITER ;
